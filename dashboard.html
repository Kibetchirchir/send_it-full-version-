<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Sendit!</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">


</head>
<body onload="allParcels()">
<div class="topnav">
    <div class="allign-right">
        <a class="active"><span>Home</span></a>
        <a id="left-login"><span>Chirchir</span></a>
    </div>
</div>
<div class="right_nav">
    <ul>
        <li><a href="dashboard.html">Home</a></li>
        <li><a href="history.html">My parcels</a></li>
        <li><a href="profile.html">Myprofile</a></li>
    </ul>
</div>
<div class="dashboard_content">
    <div class="dashboard_content">
        <form class="normaltext" >
            <label><i class="fa fa-truck"></i>Type of parcel</label><br>
            <input type="text" required placeholder="letter" id="type"><br>
            <label class="fa fa-address-book">Pick-up Adress</label><br>
            <input type="text" required placeholder="5th street moi avenue" id="pick_up_place"><br>
            <label><i class="fa fa-user"></i>Name of Recepient</label><br>
            <input type="text" required placeholder="Chirchir Kelvin" id="recepientName"><br>
            <label class="fa fa-phone">Phone number of the recepient</label><br>
            <input type="number" required placeholder="254715428709" id="tel_number"><br>
            <label class="fa fa-building">Drop off place</label><br>
            <input type="text" required placeholder="Nairobi" id="droping_place"><br>
            <label class="fa fa-calender-alt">estimated weight</label>
            <select id="weight">
                <option selected value="1">below 1kg</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">Above 5</option>
            </select><br>
            <label class="fa fa-notebook">Addition comments</label>
            <textarea rows="4" cols="50" placeholder="Fragile handle with care or flamable"></textarea><br>

            <button id="button_failed" onclick="Cancelled()">Cancel</button>
            <button type="button" onClick="makeOrder()" id="button_success">Submit</button>
        </form>
    </div>
    <div class="header">
        <br><br><br> On trasit
    </div>
    <table class="normaltext" id="data">
        <tr>
            <th>Type of parcel</th>
            <th>Pick Up Point</th>
            <th>Recepient No</th>
            <th>Recepient Name</th>
            <th>Drop off</th>
            <th>estimated weight</th>
            <th>update</th>
            <th>cancel</th>
        </tr>
    </table>
</div>
    <div class="footnote">
        <i>find us on<br><i></i>
        <a href="https://www.twitter.com/"><i class="fa fa-twitter" id="objects">twitter</i></a><br>
        <a href="https://www.facebook.com"><span class="fa fa-facebook" id="objects">facebook</span></a><br>
        <a href="https://github.com/Kibetchirchir"><span class="fa fa-github" id="objects">github</span></a><br>
        <a href="https://www.youtube.com"><span class="fa fa-youtube" id="youtube_object">youtube</span></a><br>

        <i> copyright sendit <span class="fa fa-copyright">2018
    </div>
</div>
<script type="text/javascript">
function Cancelled() {
    alert("Cancelled!");
}
</script>
<script>
function makeOrder() {
        // getting the form values
        let type = document.getElementById("type").value;
        let dropOff = document.getElementById("droping_place").value;
        let pickUp = document.getElementById("pick_up_place").value;
        let recepientName = document.getElementById("recepientName").value;
        let recepientNumber = document.getElementById("tel_number").value;
        let weight = document.getElementById("weight").value;
        let parcel_url = "https://senditv2.herokuapp.com/api/v2/parcels";
        let parcel_data = {
            parcel_type : type,
            drop_off_location : dropOff,
            pick_up_location : pickUp,
            status : "picked",
            recepient_name : recepientName,
            recepient_number : recepientNumber,
            weight : weight
        }
        fetch(parcel_url, {
            method: 'POST',
            body: JSON.stringify(parcel_data),
            headers:{
                'Content-Type': 'application/json',
                'Authorization' : "Bearer " + localStorage.getItem('token') 
            }
        })
        .then(res => res.json())
        .then(response => {
            if(response.status === "added"){
                alert("successfully added")
                location.reload();
            } else {
                alert(response.message)
            }
        })
        .catch(error => alert("OOPS try again"));
}
function allParcels() {
    let parcel_url = "https://senditv2.herokuapp.com/api/v2/parcels";
    fetch(parcel_url, {
            method: 'GET',
            headers:{
                'Content-Type': 'application/json',
                'Authorization' : "Bearer " + localStorage.getItem('token') 
            }
        })
        .then(res => res.json())
        .then(response => {
            // console.log(response)
            let parcels = response.message
            displayTable(parcels)
        })
        .catch(error => {
            alert("OOPS try again")
        });    
}
function displayTable(parcels){
    parcels.forEach(item => {
            if (item.status != "delivered") {
              let tr = document.createElement("tr");
              tr.innerHTML = `
                    <td contenteditable="true">${item.parcel_type}</td>
                    <td contenteditable="true">${item.drop_off}</td>
                    <td contenteditable="true">${item.Recepient_number}</td>
                    <td contenteditable="true">${item.Recepeint_name}</td>
                    <td contenteditable="true" id="drop_off">${item.drop_off}</td>
                    <td contenteditable="true">${item.Weight}</td>
                    <td><button onclick="Changed('${item.parcel_id}')" class="confirm" value="Submit">change</button></td>
                    <td><button onclick="Cancelled()" class="cancel" value="Submit">cancel</button></td>
                    `;
              document.getElementById("data").appendChild(tr);
            }
          });
}

function Changed(parcel_id) {
    // let dropOff = document.getElementById ( "drop_off" ).innerText
    let dest = "nai"
    let dest_url = "https://senditv2.herokuapp.com/api/v2/parcels/" + parcel_id +"/destination";
    console.log(dest_url)
    let destination = {
        dest : dest
    }
    console.log(JSON.stringify(destination))
    fetch(dest_url, {
            method: 'PUT',
            body: JSON.stringify(destination),
            headers:{
                'Content-Type': 'application/json',
                'Authorization' : "Bearer " + localStorage.getItem('token') 
            }
        })
        .then(res => res.json())
        .then(response => {
            if(response.status === "success"){
                alert(response)
                console.log(response)
            } else {
                alert(response.message)
            }
        })
        .catch(error => {
            alert("OOPS try again")
            console.log(error)
        });
}
</script>
</body>
</html>