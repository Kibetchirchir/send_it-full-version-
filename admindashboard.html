<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Sendit!</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">


</head>
<body onload="allParcels()">
<div class="topnav">
    <div class="allign-right">
        <a class="active"><span>Home</span></a>
        <a id="left-login"><span>Admin</span></a>
    </div>
</div>
<div class="right_nav">
    <ul>
        <li><a href="admindashboard.html">Home</a></li>
    </ul>
</div>
<div class="dashboard_content">
    <div class="dashboard_content">
        <div id="mainbox">
            <div class="card">
                <header>Delivered</header><br><br>
                <div class="normaltext">10</div>
            </div>
            <div class="card">
                <header>
                    On transit parcels
                </header><br><br>
                <div class="normaltext">5</div>
            </div>
            <div class="card">
                <header>
                    All parcels
                </header><br><br>
                <div class="normaltext">15</div>
            </div>
        </div>
        <div class="header">
            <br> On trasit <span class="fa fa-truck"></span>
        </div>
        <table class="normaltext" id="data">
            <tr>
                <th>Type of parcel</th>
                <th>Adress</th>
                <th>Recepient No</th>
                <th>Recepient Name</th>
                <th>Current Loc.</th>
                <th>estimated weight</th>
                <th>status</th>
                <th>update status</th>
                <th>update location</th>
            </tr>
        </table>
        <div class="header">
            <br> Delivered <span class="fa fa-check"></span>
        </div>
        <table class="normaltext" id="delivered">
            <tr>
                <th>Type of parcel</th>
                <th>Adress</th>
                <th>Recepient No</th>
                <th>Town</th>
                <th>Building</th>
                <th>estimated weight</th>
                <th>Delivered</th>
            </tr>
        </table>


    </div>

</div>
</div>
<div class="footnote">
    <i>find us on<br><i></i>
    <a href="https://www.twitter.com/"><i class="fa fa-twitter" id="objects">twitter</i></a><br>
    <a href="https://www.facebook.com"><span class="fa fa-facebook" id="objects">facebook</span></a><br>
    <a href="https://github.com/Kibetchirchir"><span class="fa fa-github" id="objects">github</span></a><br>
    <a href="https://www.youtube.com"><span class="fa fa-youtube" id="youtube_object">youtube</span></a><br>

    <i> copyright sendit <span class="fa fa-copyright">2018
</div>
</div>
<script type="text/javascript">
function allParcels() {
    let parcel_url = "https://senditv2.herokuapp.com/api/v2/parcels";
    fetch(parcel_url, {
            method: 'GET',
            headers:{
                'Content-Type': 'application/json',
                'Authorization' : "Bearer " + localStorage.getItem('token') 
            }
        })
        .then(res => res.json())
        .then(response => {
            // console.log(response)
            let parcels = response.message
            displayTable(parcels)
        })
        .catch(error => {
            alert("OOPS try again")
            console.log(error)
        });    
}
function displayTable(parcels){
    console.log(parcels)
    parcels.forEach(item => {
            if (item.status != "delivered") {
              let tr = document.createElement("tr");
              tr.innerHTML = `
                    <td contenteditable="true">${item.parcel_type}</td>
                    <td contenteditable="true">${item.drop_off}</td>
                    <td contenteditable="true">${item.Recepient_number}</td>
                    <td contenteditable="true">${item.Recepeint_name}</td>
                    <td contenteditable="true" id="location">${item.drop_off}</td>
                    <td contenteditable="true">${item.Weight}</td>
                    <td id="status" contenteditable="true">${item.status}<span class="fa fa-truck"></span></td>
                    <td><button onclick="updateStatus('${item.parcel_id}')" class="confirm" value="Submit">change status</button></td>
                    <td><button onclick="updateLocation('${item.parcel_id}')" class="confirm" value="Submit">change Location</button></td>
                    `;
              document.getElementById("data").appendChild(tr);
            }
            if(item.status === "delivered"){
                let tr = document.createElement("tr");
                tr.innerHTML = `
                    <td contenteditable="true">${item.parcel_id}</td>
                    <td contenteditable="true">${item.parcel_type}</td>
                    <td contenteditableallParcels()="true">${item.drop_off}</td>
                    <td contenteditable="true">${item.Recepient_number}</td>
                    <td contenteditable="true">${item.Recepeint_name}</td>
                    <td contenteditable="true">${item.drop_off}</td>
                    <td contenteditable="true">${item.Weight}</td>
                    <td>${item.date_ordered}</td>
                    <td>delivered<span class="fa fa-check"></span></td>
                    `;
                document.getElementById("delivered").appendChild(tr);
            }
          });
}
function updateStatus(parcel_id) {
    let status = document.getElementById ( "status" ).innerText
    let dest_url = "https://senditv2.herokuapp.com/api/v2/parcels/" + parcel_id +"/status";
    console.log(dest_url)
    let destination = {
        status : status
    }
    fetch(dest_url, {
            method: 'PUT',
            body: JSON.stringify(destination),
            headers:{
                'Content-Type': 'application/json',
                'Authorization' : "Bearer " + localStorage.getItem('token') 
            }
        })
        .then(res => res.json())
        .then(response => {
            console.log(response)
            if(response.status === "success"){
                alert("status updated to " + status)
                console.log(response)
            } else {
                alert(response.message)
            }
        })
        .catch(error => {
            alert("OOPS try again")
        });
}

function updateLocation(parcel_id) {
    let location = document.getElementById ( "location" ).innerText
    let loc_url = "https://senditv2.herokuapp.com/api/v2/parcels/" + parcel_id +"/presentLocation";
    console.log(loc_url)
    let destination = {
        location : location
    }
    fetch(loc_url, {
            method: 'PUT',
            body: JSON.stringify(destination),
            headers:{
                'Content-Type': 'application/json',
                'Authorization' : "Bearer " + localStorage.getItem('token') 
            }
        })
        .then(res => res.json())
        .then(response => {
            console.log(response)
            if(response.status === "success"){
                alert("status updated to " + status)
                console.log(response)
            } else {
                alert(response.message)
            }
        })
        .catch(error => {
            alert("OOPS try again")
        });
}
</script>
</body>
</html>